<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>TecnoiT - Field Closing</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700;900&display=swap" rel="stylesheet">

    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <meta name="theme-color" content="#ffffff">
    <link rel="apple-touch-icon" href="assets/logo.png">
    <style>
        body { font-family: 'Roboto', sans-serif; -webkit-font-smoothing: antialiased; background-color: #f8fafc; }
        .touch-btn:active { transform: scale(0.98); }
        input, textarea, select { font-size: 16px !important; } /* Prevent iOS zoom */
        .modal-overlay { background-color: rgba(0,0,0,0.5); }
    </style>
</head>
<body class="bg-slate-50 text-slate-900 h-screen overflow-hidden">
    <div id="root" class="h-full flex flex-col"></div>

    <script>
       const firebaseConfig = {
            apiKey: "AIzaSyCh47eM6oXz-vN-2iAZXbDtTIi0CvFe_wY",
            authDomain: "app-tecnoit.firebaseapp.com",
            projectId: "app-tecnoit",
            storageBucket: "app-tecnoit.firebasestorage.app",
            messagingSenderId: "675993906644",
            appId: "1:675993906644:web:90f5fdbbb852a5caa43a41",
            measurementId: "G-MLEH036DLK"
        };
    </script>

    <script type="text/babel" data-presets="react">
        const { useState, useEffect, useMemo, useCallback, useRef } = React;

        const lucideReactUrl = "https://cdn.skypack.dev/lucide-react";
        let User, Lock, LogIn, PlusCircle, Camera, Mic, Box, Trash2, CheckCircle, XCircle, ChevronDown, Wifi, WifiOff, RefreshCw;

        // Firebase is kept for potential future use or auth if needed, but the main logic is now Proxy-based
        const firebaseAppUrl = "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        const firebaseAuthUrl = "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
        const firestoreUrl = "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

        function AppWrapper() {
            const [libsLoaded, setLibsLoaded] = useState(false);
            useEffect(() => {
                Promise.all([import(lucideReactUrl), import(firebaseAppUrl), import(firebaseAuthUrl), import(firestoreUrl)])
                    .then(([lucide, app, auth, firestore]) => {
                        ({ User, Lock, LogIn, PlusCircle, Camera, Mic, Box, Trash2, CheckCircle, XCircle, ChevronDown, Wifi, WifiOff, RefreshCw } = lucide);
                        window.firebase = { app, auth, firestore };
                        setLibsLoaded(true);
                    }).catch(error => console.error("Falha ao carregar as bibliotecas:", error));
            }, []);

            if (!libsLoaded) return <LoadingScreen message="Iniciando sistema..." />;
            return <App />;
        }

        function App() {
            const { initializeApp } = window.firebase.app;
            const { getAuth, onAuthStateChanged, signInAnonymously } = window.firebase.auth;
            const app = useMemo(() => initializeApp(firebaseConfig), []);
            const auth = useMemo(() => getAuth(app), [app]);

            // App State
            const [view, setView] = useState('login'); // login, dashboard, newTicket, success
            const [user, setUser] = useState(null); // Firebase User
            const [glpiSession, setGlpiSession] = useState(null); // { sessionToken, fullSessionData, glpiUrl }
            const [isLoading, setIsLoading] = useState(true);

            // Init Firebase Auth (Anonymous for simplicity as we use GLPI Auth)
            useEffect(() => {
                const unsubscribe = onAuthStateChanged(auth, async (currentUser) => {
                    if (currentUser) {
                        setUser(currentUser);
                    } else {
                        await signInAnonymously(auth);
                    }
                });
                return () => unsubscribe();
            }, [auth]);

            // Check for saved GLPI Session on startup
            useEffect(() => {
                const checkSession = async () => {
                   const savedCreds = localStorage.getItem('glpiSessionData');
                   if (savedCreds) {
                       const parsed = JSON.parse(savedCreds);
                       // Verify if token is still valid? For now, we assume yes or let the API fail
                       setGlpiSession(parsed);
                       setView('dashboard');
                   }
                   setIsLoading(false);
                };
                if (user) checkSession();
            }, [user]);

            const handleLoginSuccess = (sessionData) => {
                setGlpiSession(sessionData);
                localStorage.setItem('glpiSessionData', JSON.stringify(sessionData));
                setView('dashboard');
            };

            const handleLogout = () => {
                setGlpiSession(null);
                localStorage.removeItem('glpiSessionData');
                setView('login');
            };

            if (isLoading) return <LoadingScreen message="Verificando sessão..." />;

            return (
                <div className="flex flex-col h-full bg-slate-50">
                     {view === 'login' && <LoginScreen onLogin={handleLoginSuccess} />}
                     {view === 'dashboard' && <Dashboard session={glpiSession} onNavigate={setView} onLogout={handleLogout} />}
                     {view === 'newTicket' && <NewTicketForm session={glpiSession} onBack={() => setView('dashboard')} />}
                </div>
            );
        }

        const LoadingScreen = ({ message }) => (
             <div className="flex flex-col items-center justify-center h-full bg-slate-50">
                <div className="w-12 h-12 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mb-4"></div>
                <p className="text-lg font-medium text-slate-600 animate-pulse">{message}</p>
            </div>
        );

        // --- 1. LOGIN SIMPLIFICADO ---
        function LoginScreen({ onLogin }) {
            const [username, setUsername] = useState('');
            const [password, setPassword] = useState('');
            const [rememberMe, setRememberMe] = useState(true); // Default true per request "Lembrar-me" priority
            const [loading, setLoading] = useState(false);
            const [error, setError] = useState('');

            useEffect(() => {
                const savedUser = localStorage.getItem('glpiUsername');
                if (savedUser) setUsername(savedUser);
            }, []);

            const handleSubmit = async (e) => {
                e.preventDefault();
                setLoading(true); setError('');

                try {
                    const glpiUrl = 'https://suporte.tecnoit.com.br';
                    // We use the Proxy to init session
                    const res = await fetch('https://tecnoit-glpi-proxy.onrender.com/api/proxy/initSession', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ glpiUrl, username, password })
                    });

                    const data = await res.json();
                    if (!res.ok) throw new Error(data.message || 'Falha na autenticação');

                    // Save username if remember me
                    if (rememberMe) localStorage.setItem('glpiUsername', username);
                    else localStorage.removeItem('glpiUsername');

                    // Need to fetch full session data to get Entities/Profile
                    const sessionRes = await fetch('https://tecnoit-glpi-proxy.onrender.com/api/proxy/getFullSession', {
                        method: 'POST',
                         headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ glpiUrl, sessionToken: data.session_token })
                    });

                    if(!sessionRes.ok) throw new Error('Erro ao carregar perfil do usuário');
                    const fullSession = (await sessionRes.json()).session;

                    onLogin({
                        sessionToken: data.session_token,
                        fullSessionData: fullSession,
                        glpiUrl
                    });

                } catch (err) {
                    setError(err.message);
                } finally {
                    setLoading(false);
                }
            };

            return (
                <div className="flex-1 flex flex-col justify-center p-6 max-w-md mx-auto w-full">
                    <div className="text-center mb-10">
                         <img src="assets/logo.png" alt="Logo" className="h-16 mx-auto mb-4 object-contain" />
                         <h1 className="text-2xl font-bold text-slate-800">Acesso Técnico</h1>
                         <p className="text-slate-500">Field Service</p>
                    </div>

                    <form onSubmit={handleSubmit} className="space-y-6 bg-white p-6 rounded-2xl shadow-sm border border-slate-100">
                        <div>
                            <label className="block text-sm font-semibold text-slate-700 mb-2">Usuário</label>
                            <div className="relative">
                                <div className="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                    {User && <User className="h-5 w-5 text-slate-400" />}
                                </div>
                                <input type="text" value={username} onChange={e => setUsername(e.target.value)}
                                    className="pl-10 w-full p-4 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:outline-none transition-all"
                                    placeholder="Seu usuário de rede" required />
                            </div>
                        </div>

                        <div>
                            <label className="block text-sm font-semibold text-slate-700 mb-2">Senha</label>
                             <div className="relative">
                                <div className="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                    {Lock && <Lock className="h-5 w-5 text-slate-400" />}
                                </div>
                                <input type="password" value={password} onChange={e => setPassword(e.target.value)}
                                    className="pl-10 w-full p-4 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:outline-none transition-all"
                                    placeholder="Sua senha" required />
                            </div>
                        </div>

                        <div className="flex items-center">
                            <input id="remember-me" type="checkbox" checked={rememberMe} onChange={e => setRememberMe(e.target.checked)}
                                className="h-5 w-5 text-blue-600 rounded border-slate-300 focus:ring-blue-500" />
                            <label htmlFor="remember-me" className="ml-2 block text-sm text-slate-700 font-medium">Lembrar meu usuário</label>
                        </div>

                        {error && <div className="p-3 bg-red-50 text-red-600 text-sm rounded-lg font-medium text-center">{error}</div>}

                        <button type="submit" disabled={loading}
                            className="w-full bg-blue-700 hover:bg-blue-800 text-white font-bold py-4 rounded-xl shadow-lg shadow-blue-200 touch-btn flex items-center justify-center transition-all disabled:opacity-70">
                            {loading ? <div className="w-6 h-6 border-2 border-white border-t-transparent rounded-full animate-spin"></div> : <span className="flex items-center gap-2 text-lg">ENTRAR {LogIn && <LogIn className="w-5 h-5" />}</span>}
                        </button>
                    </form>
                </div>
            );
        }

        // --- 3. NEW TICKET FORM ---
        function NewTicketForm({ session, onBack }) {
            const { sessionToken, fullSessionData, glpiUrl } = session;

            // State
            const [entityId, setEntityId] = useState('');
            const [entityName, setEntityName] = useState('');
            const [title, setTitle] = useState('');
            const [description, setDescription] = useState('');
            const [evidence, setEvidence] = useState(null);

            const [isModalOpen, setIsModalOpen] = useState(false);
            const [stockItems, setStockItems] = useState([]); // Array of { id, name, qty }
            const [availableStock, setAvailableStock] = useState([]); // From API

            // Modal Inputs
            const [selectedStockId, setSelectedStockId] = useState('');
            const [stockQty, setStockQty] = useState(1);

            const [isSubmitting, setIsSubmitting] = useState(false);
            const [isListening, setIsListening] = useState(false);

            // --- A. Entity Logic ---
            useEffect(() => {
                if (fullSessionData) {
                    // Check entities
                    const myEntities = fullSessionData.glpimy_entities || []; // Array of {id, name} or similar
                    // Assuming glpiactive_entity is the default.
                    // To keep it simple based on requirements:
                    // If user has > 1 entity -> Select. If 1 -> Readonly.

                    // NOTE: GLPI session data structure varies.
                    // Usually: session['glpi_current_entity'] is ID.
                    // session['glpiactive_entity_name'] is Name.
                    // session['glpiprofiles'][profileId]['entities'] is the list.

                    // Simplifying for the prompt "pull only the entity the profile has".
                    // We will use the active entity from session as default.

                    setEntityId(fullSessionData.glpiactive_entity || '');
                    setEntityName(fullSessionData.glpiactive_entity_name || 'Entidade Padrão');
                }
            }, [fullSessionData]);

            // --- B. Stock Fetch Logic ---
            useEffect(() => {
                const fetchStock = async () => {
                    try {
                        const res = await fetch('https://tecnoit-glpi-proxy.onrender.com/api/proxy/getConsumables', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ glpiUrl, sessionToken })
                        });
                        if (res.ok) {
                            const data = await res.json();
                            setAvailableStock(data);
                        } else {
                            // Fallback for UI testing if API missing
                            console.warn("API de estoque não encontrada. Usando dados fictícios.");
                            setAvailableStock([
                                { id: 1, name: 'Cabo UTP (metros)' },
                                { id: 2, name: 'Conector RJ45' },
                                { id: 3, name: 'Fita Isolante' },
                                { id: 4, name: 'Roteador Wi-Fi' }
                            ]);
                        }
                    } catch (e) {
                        console.error("Erro ao buscar estoque", e);
                         setAvailableStock([
                                { id: 1, name: 'Cabo UTP (metros)' },
                                { id: 2, name: 'Conector RJ45' },
                                { id: 3, name: 'Fita Isolante' },
                                { id: 4, name: 'Roteador Wi-Fi' }
                        ]);
                    }
                };
                fetchStock();
            }, [glpiUrl, sessionToken]);

            // --- Dictation Logic ---
            const toggleDictation = () => {
                if (!('webkitSpeechRecognition' in window)) {
                    alert("Seu navegador não suporta ditado.");
                    return;
                }

                if (isListening) {
                    setIsListening(false);
                    return;
                }

                const recognition = new window.webkitSpeechRecognition();
                recognition.lang = 'pt-BR';
                recognition.continuous = false;
                recognition.interimResults = false;

                recognition.onstart = () => setIsListening(true);
                recognition.onend = () => setIsListening(false);
                recognition.onerror = (event) => { console.error(event.error); setIsListening(false); };

                recognition.onresult = (event) => {
                    const transcript = event.results[0][0].transcript;
                    setDescription(prev => (prev ? prev + ' ' + transcript : transcript));
                };

                recognition.start();
            };

            // --- Stock Helpers ---
            const handleAddStock = () => {
                if (!selectedStockId || stockQty <= 0) return;
                const item = availableStock.find(s => String(s.id) === String(selectedStockId));
                if (item) {
                    setStockItems(prev => [...prev, { id: item.id, name: item.name, qty: stockQty }]);
                }
                setSelectedStockId('');
                setStockQty(1);
                setIsModalOpen(false);
            };

            const removeStockItem = (index) => {
                setStockItems(prev => prev.filter((_, i) => i !== index));
            };

            // --- Submission ---
            const handleSubmit = async () => {
                if (!title || !description) return alert("Preencha o título e a descrição.");

                setIsSubmitting(true);
                try {
                    // Upload Image First if exists
                    let documentId = null;
                    if (evidence) {
                        // Mock upload logic or implement real upload if endpoint exists
                        // documentId = await uploadImage(evidence);
                    }

                    // Create Ticket Payload
                    const payload = {
                        glpiUrl,
                        sessionToken,
                        input: {
                            name: title,
                            content: description,
                            entities_id: entityId,
                            status: 2, // Em atendimento / Novo
                            // Add logic for stock usage in content or separate generic object?
                            // GLPI usually handles consumables via specific tab, but for simplified app,
                            // we might append to description or use a plugin endpoint.
                            // We will append to description for now as fail-safe.
                        },
                        stockItems // Pass this for the proxy to handle if it can
                    };

                    const res = await fetch('https://tecnoit-glpi-proxy.onrender.com/api/proxy/createTicket', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (!res.ok) throw new Error("Erro ao criar chamado.");

                    alert("Chamado finalizado com sucesso!");
                    onBack(); // Go back to dashboard
                } catch (e) {
                    alert("Erro ao finalizar: " + e.message);
                } finally {
                    setIsSubmitting(false);
                }
            };

            const handleFileChange = (e) => {
                if (e.target.files[0]) setEvidence(e.target.files[0]);
            };

            return (
                <div className="flex-1 flex flex-col bg-slate-50 relative overflow-hidden">
                    {/* Header */}
                    <div className="bg-white p-4 shadow-sm flex items-center gap-4 z-10">
                         <button onClick={onBack} className="p-2 -ml-2 text-slate-500 hover:bg-slate-100 rounded-full">
                            <ChevronDown className="w-6 h-6 rotate-90" />
                         </button>
                         <h2 className="text-xl font-bold text-slate-800">Novo Atendimento</h2>
                    </div>

                    <div className="flex-1 overflow-y-auto p-4 space-y-8 pb-32">

                        {/* Bloco A: Identificação */}
                        <section className="bg-white p-5 rounded-2xl shadow-sm border border-slate-100 space-y-4">
                            <div className="flex items-center gap-2 mb-2">
                                <Box className="w-5 h-5 text-blue-600" />
                                <h3 className="font-bold text-slate-700">Identificação</h3>
                            </div>
                            <div>
                                <label className="block text-sm font-semibold text-slate-500 mb-1">Cliente / Entidade</label>
                                <div className="p-3 bg-slate-100 rounded-xl text-slate-800 font-medium border border-slate-200">
                                    {entityName}
                                </div>
                                {/* Future: Add Dropdown here if myEntities.length > 1 */}
                            </div>
                            <div>
                                <label className="block text-sm font-semibold text-slate-500 mb-1">Título Resumido</label>
                                <input type="text" value={title} onChange={e => setTitle(e.target.value)}
                                    placeholder="Ex: Troca de Roteador"
                                    className="w-full p-3 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-blue-500 outline-none" />
                            </div>
                        </section>

                        {/* Bloco B: Relato Técnico */}
                        <section className="bg-white p-5 rounded-2xl shadow-sm border border-slate-100 space-y-4">
                             <div className="flex items-center gap-2 mb-2">
                                <RefreshCw className="w-5 h-5 text-blue-600" />
                                <h3 className="font-bold text-slate-700">Relato Técnico</h3>
                            </div>
                            <div className="relative">
                                <label className="block text-sm font-semibold text-slate-500 mb-1">Descrição do Serviço</label>
                                <textarea value={description} onChange={e => setDescription(e.target.value)}
                                    rows="5"
                                    placeholder="Descreva o que foi feito..."
                                    className="w-full p-3 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-blue-500 outline-none resize-none" />
                                <button onClick={toggleDictation} type="button"
                                    className={`absolute right-3 bottom-3 p-3 rounded-full shadow-md transition-colors ${isListening ? 'bg-red-500 text-white animate-pulse' : 'bg-white text-slate-500 border border-slate-200'}`}>
                                    <Mic className="w-5 h-5" />
                                </button>
                            </div>

                            <div>
                                <input type="file" id="evidence-upload" accept="image/*" capture="environment" className="hidden" onChange={handleFileChange} />
                                <label htmlFor="evidence-upload" className="flex items-center justify-center gap-3 w-full p-4 border-2 border-dashed border-slate-300 rounded-xl text-slate-500 font-medium active:bg-slate-50 cursor-pointer">
                                    {evidence ? (
                                        <>
                                            <CheckCircle className="w-5 h-5 text-green-500" />
                                            <span className="text-green-600 truncate">{evidence.name}</span>
                                        </>
                                    ) : (
                                        <>
                                            <Camera className="w-5 h-5" />
                                            Anexar Evidências
                                        </>
                                    )}
                                </label>
                                {evidence && <button onClick={() => setEvidence(null)} className="mt-2 text-xs text-red-500 font-medium block text-center">Remover foto</button>}
                            </div>
                        </section>

                         {/* Bloco C: Controle de Insumos */}
                        <section className="bg-white p-5 rounded-2xl shadow-sm border border-slate-100 space-y-4">
                             <div className="flex items-center gap-2 mb-2">
                                <Box className="w-5 h-5 text-blue-600" />
                                <h3 className="font-bold text-slate-700">Controle de Insumos</h3>
                            </div>

                            {stockItems.length > 0 ? (
                                <ul className="space-y-2">
                                    {stockItems.map((item, idx) => (
                                        <li key={idx} className="flex justify-between items-center bg-slate-50 p-3 rounded-lg border border-slate-200">
                                            <span className="font-medium text-slate-700"><span className="font-bold text-blue-600">{item.qty}x</span> {item.name}</span>
                                            <button onClick={() => removeStockItem(idx)} className="text-red-400 p-1"><Trash2 className="w-4 h-4" /></button>
                                        </li>
                                    ))}
                                </ul>
                            ) : (
                                <p className="text-center text-slate-400 text-sm py-2">Nenhum material utilizado.</p>
                            )}

                            <button onClick={() => setIsModalOpen(true)} className="w-full py-3 bg-blue-50 text-blue-700 font-bold rounded-xl border border-blue-100 flex items-center justify-center gap-2 active:bg-blue-100 transition-colors">
                                <PlusCircle className="w-5 h-5" /> ADICIONAR MATERIAL
                            </button>
                        </section>
                    </div>

                    {/* Footer Actions */}
                    <div className="absolute bottom-0 left-0 right-0 bg-white p-4 border-t border-slate-200 flex gap-3 shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.1)]">
                        <button onClick={onBack} className="flex-1 bg-slate-100 text-slate-700 font-bold py-4 rounded-xl active:bg-slate-200 transition-colors">
                            CANCELAR
                        </button>
                        <button onClick={handleSubmit} disabled={isSubmitting || !title || !description}
                            className="flex-[2] bg-green-600 text-white font-bold py-4 rounded-xl shadow-lg shadow-green-200 active:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all flex items-center justify-center gap-2">
                            {isSubmitting ? 'ENVIANDO...' : 'FINALIZAR CHAMADO'}
                            {!isSubmitting && <CheckCircle className="w-5 h-5" />}
                        </button>
                    </div>

                    {/* Modal Insumos */}
                    {isModalOpen && (
                        <div className="fixed inset-0 z-50 flex items-end sm:items-center justify-center modal-overlay p-4 animate-fade-in">
                            <div className="bg-white w-full max-w-sm rounded-2xl p-6 shadow-2xl space-y-4 animate-slide-up">
                                <h3 className="text-lg font-bold text-slate-800">Adicionar Material</h3>

                                <div>
                                    <label className="block text-sm font-semibold text-slate-500 mb-1">Item</label>
                                    <select value={selectedStockId} onChange={e => setSelectedStockId(e.target.value)}
                                        className="w-full p-3 bg-slate-50 border border-slate-200 rounded-xl outline-none focus:ring-2 focus:ring-blue-500">
                                        <option value="">Selecione um item...</option>
                                        {availableStock.map(s => (
                                            <option key={s.id} value={s.id}>{s.name}</option>
                                        ))}
                                    </select>
                                </div>

                                <div>
                                    <label className="block text-sm font-semibold text-slate-500 mb-1">Quantidade</label>
                                    <input type="number" min="1" value={stockQty} onChange={e => setStockQty(parseInt(e.target.value))}
                                        className="w-full p-3 bg-slate-50 border border-slate-200 rounded-xl outline-none focus:ring-2 focus:ring-blue-500" />
                                </div>

                                <div className="flex gap-3 pt-2">
                                    <button onClick={() => setIsModalOpen(false)} className="flex-1 py-3 text-slate-500 font-bold">Cancelar</button>
                                    <button onClick={handleAddStock} className="flex-1 py-3 bg-blue-600 text-white rounded-xl font-bold shadow-lg shadow-blue-200">Confirmar</button>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        // --- 2. DASHBOARD ---
        function Dashboard({ session, onNavigate, onLogout }) {
            const userName = session?.fullSessionData?.glpifirstname || 'Técnico';

            return (
                <div className="flex-1 flex flex-col relative">
                    {/* Header Minimalista */}
                    <header className="bg-white p-4 flex justify-between items-center shadow-sm z-10">
                        <div className="flex items-center gap-2">
                            <div className="w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center text-blue-700 font-bold">
                                {userName.charAt(0)}
                            </div>
                            <span className="font-semibold text-slate-700 truncate max-w-[150px]">{userName}</span>
                        </div>
                        <button onClick={onLogout} className="text-sm text-slate-500 font-medium px-3 py-1 bg-slate-100 rounded-lg hover:bg-slate-200">
                            Sair
                        </button>
                    </header>

                    {/* Main Content - Center Focus */}
                    <main className="flex-1 flex flex-col items-center justify-center p-6 gap-8">

                        <div className="text-center space-y-2">
                             <h2 className="text-3xl font-black text-slate-800 tracking-tight">O que vamos fazer agora?</h2>
                             <p className="text-slate-500">Selecione uma ação abaixo</p>
                        </div>

                        <button onClick={() => onNavigate('newTicket')}
                            className="w-full max-w-sm aspect-square bg-blue-600 hover:bg-blue-700 active:bg-blue-800 text-white rounded-3xl shadow-xl shadow-blue-200 flex flex-col items-center justify-center gap-4 transition-all transform touch-btn group">
                            <div className="p-4 bg-white/20 rounded-2xl group-hover:scale-110 transition-transform">
                                {PlusCircle && <PlusCircle className="w-16 h-16 text-white" />}
                            </div>
                            <span className="text-2xl font-bold tracking-wide">NOVO ATENDIMENTO</span>
                        </button>

                         {/* Status Indicator (Fake for now, or check navigator.onLine) */}
                         <div className="absolute bottom-6 left-0 right-0 flex justify-center">
                            <div className={`flex items-center gap-2 px-4 py-2 rounded-full ${navigator.onLine ? 'bg-green-50 text-green-700 border border-green-200' : 'bg-red-50 text-red-700 border border-red-200'}`}>
                                {navigator.onLine ? <Wifi className="w-4 h-4" /> : <WifiOff className="w-4 h-4" />}
                                <span className="text-xs font-bold uppercase">{navigator.onLine ? 'Conectado ao Servidor' : 'Sem Conexão'}</span>
                            </div>
                         </div>
                    </main>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<AppWrapper />);
    </script>
</body>
</html>
