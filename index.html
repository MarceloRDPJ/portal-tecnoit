<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Tecno iT - Portal de Chamados</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap');
  </style>
  <script src="https://cdn.tailwindcss.com/3.4.1"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: {
            poppins: ['Poppins', 'sans-serif'],
          },
          colors: {
            'tecnoit-bg': '#1a2035',
            'tecnoit-bg-light': '#2a314b',
            'tecnoit-orange': '#ff5a00',
            'tecnoit-orange-hover': '#e65100',
            'tecnoit-text': '#d0d2d6',
            'tecnoit-text-light': '#a0a4b1',
          },
        },
      },
    };
  </script>
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>

<body class="bg-tecnoit-bg text-tecnoit-text font-poppins">
  <div id="root"></div>

  <script type="module">
    // Módulos do Firebase
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
    import {
      getFirestore, doc, setDoc, getDoc, collection, addDoc, onSnapshot, query, serverTimestamp
    } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
    // Módulo de Ícones (Lucide)
    import { LoaderCircle, Ticket, LayoutGrid, MessageSquare, CheckSquare, ArrowLeft, RefreshCw, LogOut } from "https://cdn.jsdelivr.net/npm/lucide-react@0.378.0/dist/lucide-react.mjs";


    // Mapeamento de status e prioridades do GLPI
    const GLPI_STATUSES = { 1: 'Novo', 2: 'Em Atendimento', 3: 'Em Atendimento (planejado)', 4: 'Pendente', 5: 'Solucionado', 6: 'Fechado' };
    const GLPI_PRIORITIES = { 1: 'Muito Baixa', 2: 'Baixa', 3: 'Média', 4: 'Alta', 5: 'Muito Alta', 6: 'Urgente' };

    // --- Início do Bloco de Configuração do Firebase ---
    const firebaseConfig = {
      apiKey: "AIzaSyCh47eM6oXz-vN-2iAZXbDtTIi0CvFe_wY",
      authDomain: "app-tecnoit.firebaseapp.com",
      projectId: "app-tecnoit",
      storageBucket: "app-tecnoit.appspot.com",
      messagingSenderId: "675993906644",
      appId: "1:675993906644:web:90f5fdbbb852a5caa43a41",
      measurementId: "G-MLEH036DLK"
    };
    // --- Fim do Bloco de Configuração do Firebase ---

    let app;
    let auth;
    let db;
    let userId;

    // Função para inicializar o Firebase e autenticar
    async function initFirebase() {
        try {
            if (!firebaseConfig || !firebaseConfig.apiKey) {
                console.error("Configuração do Firebase está faltando ou incompleta.");
                const root = ReactDOM.createRoot(document.getElementById("root"));
                root.render(React.createElement(FirebaseErrorScreen));
                return null;
            }

            app = initializeApp(firebaseConfig);
            auth = getAuth(app);
            db = getFirestore(app);

            await signInAnonymously(auth);
            userId = auth.currentUser.uid;
            console.log("Usuário autenticado anonimamente:", userId);
            return { app, auth, db, userId };
        } catch (error) {
            console.error("Erro na inicialização ou autenticação do Firebase:", error);
            const root = ReactDOM.createRoot(document.getElementById("root"));
            root.render(React.createElement(FirebaseErrorScreen, { error: error.message }));
            return null;
        }
    }


    // Componente para tela de erro do Firebase
    function FirebaseErrorScreen({ error }) {
      return React.createElement('div', { className: 'flex flex-col items-center justify-center h-screen bg-red-900 text-white p-8' },
        React.createElement('h1', { className: 'text-3xl font-bold mb-4' }, 'Erro de Configuração'),
        React.createElement('p', { className: 'text-center mb-2' }, 'A configuração do Firebase não foi encontrada no arquivo `index.html`.'),
        React.createElement('p', { className: 'text-center' }, 'Por favor, siga as instruções no guia para adicionar suas chaves de API do Firebase.'),
        error && React.createElement('code', { className: 'mt-4 p-2 bg-red-800 rounded' }, error)
      );
    }


    // Componente principal da aplicação
    function App() {
      const [currentView, setCurrentView] = React.useState('glpi');
      const [firebaseReady, setFirebaseReady] = React.useState(false);

      React.useEffect(() => {
        if (!firebaseReady) {
            initFirebase().then(result => {
                if (result) {
                    setFirebaseReady(true);
                }
            });
        }
      }, [firebaseReady]);


      if (!firebaseReady) {
          return React.createElement('div', { className: 'flex items-center justify-center h-screen' },
              React.createElement(LoaderCircle, { className: 'animate-spin h-12 w-12 text-tecnoit-orange' })
          );
      }

      return React.createElement('div', { className: 'flex h-screen bg-tecnoit-bg font-poppins' },
        React.createElement(Sidebar, { currentView, setCurrentView }),
        React.createElement('main', { className: 'flex-1 p-8 overflow-y-auto' },
          React.createElement(Header),
          currentView === 'glpi' && React.createElement(GlpiTickets),
          currentView === 'painel' && React.createElement('h2', { className: 'text-2xl font-semibold' }, 'Painel em desenvolvimento'),
          currentView === 'chat' && React.createElement(Chat),
          currentView === 'tarefas' && React.createElement(Tasks)
        )
      );
    }

    // --- Componentes da Interface ---

    function Sidebar({ currentView, setCurrentView }) {
        const navItems = [
            { id: 'glpi', label: 'Chamados GLPI', icon: Ticket },
            { id: 'painel', label: 'Painel', icon: LayoutGrid },
            { id: 'chat', label: 'Chat', icon: MessageSquare },
            { id: 'tarefas', label: 'Tarefas', icon: CheckSquare },
        ];

        const logoIcon = React.createElement('div', { className: 'bg-tecnoit-orange rounded-full w-10 h-10 flex items-center justify-center' },
            React.createElement('span', { className: 'text-white text-xl font-bold italic' }, 'iT')
        );

        return React.createElement('aside', { className: 'w-64 bg-tecnoit-bg-light p-6 flex flex-col' },
            React.createElement('div', { className: 'flex items-center gap-3 mb-10' },
                logoIcon,
                React.createElement('h1', { className: 'text-2xl font-bold' }, 'Tecno iT')
            ),
            React.createElement('nav', { className: 'flex flex-col gap-2' },
                ...navItems.map(item =>
                    React.createElement('button', {
                        key: item.id,
                        onClick: () => setCurrentView(item.id),
                        className: `flex items-center gap-3 p-3 rounded-lg text-left transition-colors ${currentView === item.id ? 'bg-tecnoit-orange text-white' : 'hover:bg-tecnoit-bg'}`
                    },
                        React.createElement(item.icon, { className: 'h-5 w-5' }),
                        item.label
                    )
                )
            )
        );
    }


    function Header() {
      return React.createElement('header', { className: 'mb-8' },
        React.createElement('h1', { className: 'text-3xl font-bold' }, 'Bem-vindo(a) de volta!'),
        React.createElement('p', { className: 'text-tecnoit-text-light' }, 'Pronto para um dia produtivo?')
      );
    }
    
    // --- Seção GLPI ---

    function GlpiTickets() {
        const [glpiConfig, setGlpiConfig] = React.useState(null);
        const [sessionToken, setSessionToken] = React.useState(null);
        const [tickets, setTickets] = React.useState([]);
        const [loading, setLoading] = React.useState(true);
        const [error, setError] = React.useState('');
        const [selectedTicket, setSelectedTicket] = React.useState(null);
        
        React.useEffect(() => {
            if (!db || !userId) return;
            const configRef = doc(db, `artifacts/${app.options.appId}/users/${userId}/glpiConfig`, 'config');
            const unsubscribe = onSnapshot(configRef, (docSnap) => {
                if (docSnap.exists()) {
                    const config = docSnap.data();
                    setGlpiConfig(config);
                    if (config.sessionToken) {
                        setSessionToken(config.sessionToken);
                    }
                }
                setLoading(false);
            });
            return () => unsubscribe();
        }, []);

        const handleConnect = async (authDetails) => {
            setLoading(true);
            setError('');
            try {
                const response = await fetch('https://tecnoit-glpi-proxy.onrender.com/api/proxy/initSession', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(authDetails),
                });
                const data = await response.json();
                
                if (response.ok) {
                    setSessionToken(data.session_token);
                    const configRef = doc(db, `artifacts/${app.options.appId}/users/${userId}/glpiConfig`, 'config');
                    const newConfig = {
                        glpiUrl: authDetails.glpiUrl,
                        sessionToken: data.session_token,
                        ...(authDetails.apiToken && { apiToken: authDetails.apiToken }),
                        ...(authDetails.username && { username: authDetails.username }),
                    };
                    await setDoc(configRef, newConfig, { merge: true });

                } else {
                    throw new Error(data.error || 'Falha ao iniciar sessão no GLPI.');
                }
            } catch (err) {
                 console.error("Erro de conexão:", err);
                 setError(`Falha na conexão: ${err.message}. Verifique a URL, as credenciais e se o serviço de back-end está no ar.`);
            } finally {
                setLoading(false);
            }
        };

        const fetchTickets = async () => {
             if (!sessionToken || !glpiConfig) return;
             setLoading(true);
             setError('');
             try {
                const response = await fetch('https://tecnoit-glpi-proxy.onrender.com/api/proxy/getTickets', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        glpiUrl: glpiConfig.glpiUrl,
                        sessionToken: sessionToken
                    }),
                });
                const data = await response.json();
                if (response.ok) {
                    setTickets(data);
                } else {
                    throw new Error(data.error || 'Falha ao buscar chamados.');
                }
            } catch (err) {
                console.error("Erro ao buscar chamados:", err);
                setError(err.message);
                if (err.message.includes('TOKEN_INVALID')) {
                    // Token expirou, desconectar
                    handleLogout();
                }
            } finally {
                setLoading(false);
            }
        };
        
        React.useEffect(() => {
            if (sessionToken && glpiConfig) {
                fetchTickets();
            }
        }, [sessionToken, glpiConfig]);
        
        const handleLogout = async () => {
            const configRef = doc(db, `artifacts/${app.options.appId}/users/${userId}/glpiConfig`, 'config');
            await setDoc(configRef, { sessionToken: null }, { merge: true });
            setSessionToken(null);
            setTickets([]);
            setSelectedTicket(null);
        };

        const handleTicketAction = async (ticketId, actionType, content) => {
            setLoading(true);
            try {
                const response = await fetch('https://tecnoit-glpi-proxy.onrender.com/api/proxy/addTicketAction', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        glpiUrl: glpiConfig.glpiUrl,
                        sessionToken,
                        ticketId,
                        actionType, // 'ITILFollowup' ou 'ITILSolution'
                        content
                    }),
                });
                const data = await response.json();
                if (response.ok) {
                    // Atualiza a visualização do chamado
                    fetchTickets(); 
                    setSelectedTicket(prev => ({...prev, ...data.updatedTicketData})); // Simulação, o ideal é refetch
                } else {
                    throw new Error(data.error || `Falha ao adicionar ${actionType}`);
                }
            } catch (err) {
                console.error(`Erro em ${actionType}:`, err);
                setError(err.message);
            } finally {
                setLoading(false);
            }
        };

        if (loading && !sessionToken) {
            return React.createElement('div', { className: 'flex items-center justify-center h-full' },
                React.createElement(LoaderCircle, { className: 'animate-spin h-8 w-8 text-tecnoit-orange' })
            );
        }

        if (!sessionToken) {
            return React.createElement(ConnectionForm, { onConnect: handleConnect, loading, error });
        }

        if (selectedTicket) {
            return React.createElement(TicketDetail, { 
                ticket: selectedTicket, 
                onBack: () => setSelectedTicket(null),
                onAddFollowup: (content) => handleTicketAction(selectedTicket.id, 'ITILFollowup', content),
                onAddSolution: (content) => handleTicketAction(selectedTicket.id, 'ITILSolution', content),
                loading
            });
        }

        return React.createElement(TicketList, { tickets, loading, error, onSelectTicket: setSelectedTicket, onLogout: handleLogout, onRefresh: fetchTickets });
    }

    function ConnectionForm({ onConnect, loading, error }) {
        const [loginType, setLoginType] = React.useState('token'); // 'token' ou 'credentials'
        const [apiToken, setApiToken] = React.useState('');
        const [username, setUsername] = React.useState('');
        const [password, setPassword] = React.useState('');

        const handleSubmit = (e) => {
            e.preventDefault();
            const glpiUrl = "https://suporte.tecnoit.com.br";
            let authDetails = { glpiUrl };

            if (loginType === 'token') {
                authDetails.apiToken = apiToken;
            } else {
                authDetails.username = username;
                authDetails.password = password;
            }
            onConnect(authDetails);
        };
        
        const logoIcon = React.createElement('div', { className: 'mx-auto bg-tecnoit-orange rounded-full w-12 h-12 flex items-center justify-center mb-4' },
            React.createElement('span', { className: 'text-white text-2xl font-bold italic' }, 'iT')
        );


        return React.createElement('div', { className: 'max-w-md mx-auto mt-10 p-8 bg-tecnoit-bg-light rounded-2xl shadow-lg' },
            logoIcon,
            React.createElement('h2', { className: 'text-2xl font-bold text-center mb-2' }, 'Conectar ao GLPI'),
            React.createElement('p', { className: 'text-center text-tecnoit-text-light mb-6' }, 'Insira seus dados para visualizar os chamados.'),
            React.createElement('div', { className: 'mb-4 flex justify-center bg-tecnoit-bg p-1 rounded-lg' },
                React.createElement('button', {
                    onClick: () => setLoginType('token'),
                    className: `px-4 py-2 text-sm font-semibold rounded-md transition ${loginType === 'token' ? 'bg-tecnoit-orange text-white' : 'text-tecnoit-text-light'}`
                }, 'API Token'),
                React.createElement('button', {
                    onClick: () => setLoginType('credentials'),
                    className: `px-4 py-2 text-sm font-semibold rounded-md transition ${loginType === 'credentials' ? 'bg-tecnoit-orange text-white' : 'text-tecnoit-text-light'}`
                }, 'Usuário & Senha')
            ),
            React.createElement('form', { onSubmit: handleSubmit },
                React.createElement('div', { className: 'mb-4' },
                    React.createElement('label', { className: 'block text-sm font-medium mb-2' }, 'URL da Instância GLPI'),
                    React.createElement('input', {
                        type: 'text',
                        readOnly: true,
                        value: "https://suporte.tecnoit.com.br",
                        className: 'w-full p-3 bg-tecnoit-bg rounded-lg border border-gray-600 focus:ring-tecnoit-orange focus:border-tecnoit-orange cursor-not-allowed text-gray-400'
                    })
                ),

                loginType === 'token' ?
                React.createElement('div', { className: 'mb-6' },
                    React.createElement('label', { className: 'block text-sm font-medium mb-2' }, 'Seu App-Token'),
                    React.createElement('input', {
                        type: 'password',
                        value: apiToken,
                        onChange: (e) => setApiToken(e.target.value),
                        placeholder: 'Token de acesso da API',
                        className: 'w-full p-3 bg-tecnoit-bg rounded-lg border border-gray-600 focus:ring-tecnoit-orange focus:border-tecnoit-orange'
                    })
                ) :
                React.createElement(React.Fragment, null,
                    React.createElement('div', { className: 'mb-4' },
                        React.createElement('label', { className: 'block text-sm font-medium mb-2' }, 'Usuário'),
                        React.createElement('input', {
                            type: 'text',
                            value: username,
                            onChange: (e) => setUsername(e.target.value),
                            placeholder: 'Seu usuário do GLPI',
                            className: 'w-full p-3 bg-tecnoit-bg rounded-lg border border-gray-600 focus:ring-tecnoit-orange focus:border-tecnoit-orange'
                        })
                    ),
                    React.createElement('div', { className: 'mb-6' },
                        React.createElement('label', { className: 'block text-sm font-medium mb-2' }, 'Senha'),
                        React.createElement('input', {
                            type: 'password',
                            value: password,
                            onChange: (e) => setPassword(e.target.value),
                            placeholder: 'Sua senha',
                            className: 'w-full p-3 bg-tecnoit-bg rounded-lg border border-gray-600 focus:ring-tecnoit-orange focus:border-tecnoit-orange'
                        })
                    )
                ),
                
                React.createElement('button', {
                    type: 'submit',
                    disabled: loading,
                    className: 'w-full bg-tecnoit-orange text-white font-bold py-3 px-4 rounded-lg hover:bg-tecnoit-orange-hover transition-colors flex items-center justify-center'
                },
                    loading ? React.createElement(LoaderCircle, { className: 'animate-spin h-5 w-5' }) : 'Conectar'
                ),
                error && React.createElement('p', { className: 'text-red-400 text-sm mt-4 text-center' }, error)
            )
        );
    }
    
    function TicketList({ tickets, loading, error, onSelectTicket, onLogout, onRefresh }) {
        return React.createElement('div', null,
            React.createElement('div', { className: 'flex justify-between items-center mb-4' },
                React.createElement('h2', { className: 'text-2xl font-semibold' }, 'Meus Chamados'),
                React.createElement('div', { className: 'flex items-center gap-2' },
                    React.createElement('button', { onClick: onRefresh, className: 'p-2 rounded-lg bg-tecnoit-bg-light hover:bg-tecnoit-bg', disabled: loading }, 
                        React.createElement(RefreshCw, { className: `h-5 w-5 ${loading ? 'animate-spin' : ''}` })
                    ),
                    React.createElement('button', { onClick: onLogout, className: 'p-2 rounded-lg bg-red-800 hover:bg-red-700 text-white flex items-center gap-2 text-sm px-3' }, 
                         React.createElement(LogOut, { className: 'h-4 w-4' }), 'Sair'
                    )
                )
            ),
            error && React.createElement('p', { className: 'text-red-400' }, error),
            loading ?
                React.createElement('p', null, 'Carregando chamados...') :
                React.createElement('div', { className: 'bg-tecnoit-bg-light rounded-lg' },
                    React.createElement('table', { className: 'w-full text-left' },
                        React.createElement('thead', null,
                            React.createElement('tr', { className: 'border-b border-tecnoit-bg' },
                                React.createElement('th', { className: 'p-4' }, 'ID'),
                                React.createElement('th', { className: 'p-4' }, 'Título'),
                                React.createElement('th', { className: 'p-4' }, 'Status'),
                                React.createElement('th', { className: 'p-4' }, 'Prioridade')
                            )
                        ),
                        React.createElement('tbody', null,
                            tickets.map(ticket =>
                                React.createElement('tr', {
                                    key: ticket.id,
                                    onClick: () => onSelectTicket(ticket),
                                    className: 'hover:bg-tecnoit-bg cursor-pointer border-b border-tecnoit-bg last:border-b-0'
                                },
                                    React.createElement('td', { className: 'p-4' }, ticket.id),
                                    React.createElement('td', { className: 'p-4' }, ticket.name),
                                    React.createElement('td', { className: 'p-4' }, GLPI_STATUSES[ticket.status] || ticket.status),
                                    React.createElement('td', { className: 'p-4' },
                                        React.createElement('span', { className: `px-2 py-1 text-xs rounded-full ${
                                            ticket.priority >= 4 ? 'bg-red-500 text-white' : 
                                            ticket.priority === 3 ? 'bg-yellow-500 text-black' : 'bg-gray-500 text-white'
                                        }`},
                                        GLPI_PRIORITIES[ticket.priority] || ticket.priority)
                                    )
                                )
                            )
                        )
                    )
                )
        );
    }
    
    function TicketDetail({ ticket, onBack, onAddFollowup, onAddSolution, loading }) {
        const [newItemContent, setNewItemContent] = React.useState('');
        const [actionType, setActionType] = React.useState('followup'); // 'followup' ou 'solution'
    
        const handleSubmit = (e) => {
            e.preventDefault();
            if (!newItemContent.trim()) return;
            if (actionType === 'followup') {
                onAddFollowup(newItemContent);
            } else {
                onAddSolution(newItemContent);
            }
            setNewItemContent('');
        };
    
        return React.createElement('div', null,
            React.createElement('button', { onClick: onBack, className: 'flex items-center gap-2 mb-4 text-tecnoit-text-light hover:text-white' },
                React.createElement(ArrowLeft, { className: 'h-4 w-4' }),
                'Voltar para a lista'
            ),
            React.createElement('div', { className: 'bg-tecnoit-bg-light p-6 rounded-lg' },
                React.createElement('h2', { className: 'text-2xl font-bold mb-1' }, `Chamado #${ticket.id}: ${ticket.name}`),
                React.createElement('div', { dangerouslySetInnerHTML: { __html: ticket.content } }),
                React.createElement('hr', { className: 'my-4 border-gray-700' }),
                // ... outros detalhes do ticket (status, prioridade, etc.)
                React.createElement('h3', { className: 'text-lg font-semibold mt-6 mb-4' }, 'Adicionar Interação'),
                React.createElement('form', { onSubmit: handleSubmit },
                    React.createElement('div', { className: 'mb-2 flex items-center gap-4'},
                        React.createElement('label', null,
                           React.createElement('input', {type: 'radio', name: 'actionType', value: 'followup', checked: actionType === 'followup', onChange: () => setActionType('followup')}),
                           ' Acompanhamento'
                        ),
                        React.createElement('label', null,
                           React.createElement('input', {type: 'radio', name: 'actionType', value: 'solution', checked: actionType === 'solution', onChange: () => setActionType('solution')}),
                           ' Solução'
                        )
                    ),
                    React.createElement('textarea', {
                        value: newItemContent,
                        onChange: (e) => setNewItemContent(e.target.value),
                        placeholder: actionType === 'followup' ? 'Descreva o acompanhamento...' : 'Descreva a solução...',
                        className: 'w-full p-3 bg-tecnoit-bg rounded-lg border border-gray-600 focus:ring-tecnoit-orange focus:border-tecnoit-orange min-h-[100px]'
                    }),
                    React.createElement('button', {
                        type: 'submit',
                        disabled: loading,
                        className: 'mt-2 bg-tecnoit-orange text-white font-bold py-2 px-4 rounded-lg hover:bg-tecnoit-orange-hover transition-colors flex items-center justify-center'
                    },
                        loading ? React.createElement(LoaderCircle, { className: 'animate-spin h-5 w-5' }) : 'Adicionar'
                    )
                )
            )
        );
    }


    // --- Seção de Chat ---
    function Chat() {
        const [messages, setMessages] = React.useState([]);
        const [newMessage, setNewMessage] = React.useState('');
        const messagesEndRef = React.useRef(null);

        React.useEffect(() => {
            if (!db || !userId) return;
            const messagesCol = collection(db, `artifacts/${app.options.appId}/public/data/chat`);
            const q = query(messagesCol);
            const unsubscribe = onSnapshot(q, (querySnapshot) => {
                const msgs = [];
                querySnapshot.forEach((doc) => {
                    msgs.push({ id: doc.id, ...doc.data() });
                });
                msgs.sort((a, b) => a.timestamp?.toMillis() - b.timestamp?.toMillis());
                setMessages(msgs);
            });
            return () => unsubscribe();
        }, []);

        React.useEffect(() => {
            messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });
        }, [messages]);

        const handleSendMessage = async (e) => {
            e.preventDefault();
            if (newMessage.trim() === '') return;
            const messagesCol = collection(db, `artifacts/${app.options.appId}/public/data/chat`);
            await addDoc(messagesCol, {
                text: newMessage,
                timestamp: serverTimestamp(),
                uid: userId,
            });
            setNewMessage('');
        };
        
        const Message = ({ msg }) => {
            const isMe = msg.uid === userId;
            return React.createElement('div', { className: `flex ${isMe ? 'justify-end' : 'justify-start'} mb-4` },
                React.createElement('div', { className: `max-w-xs md:max-w-md lg:max-w-lg px-4 py-3 rounded-2xl ${isMe ? 'bg-tecnoit-orange text-white rounded-br-none' : 'bg-tecnoit-bg-light rounded-bl-none'}` },
                    React.createElement('p', { className: 'text-sm' }, msg.text)
                )
            );
        };


        return React.createElement('div', { className: 'flex flex-col h-full max-h-[calc(100vh-150px)]' },
            React.createElement('h2', { className: 'text-2xl font-semibold mb-4' }, 'Chat da Equipe'),
            React.createElement('div', { className: 'flex-1 bg-tecnoit-bg-light p-4 rounded-lg overflow-y-auto' },
                messages.map(msg => React.createElement(Message, { key: msg.id, msg })),
                React.createElement('div', { ref: messagesEndRef })
            ),
            React.createElement('form', { onSubmit: handleSendMessage, className: 'mt-4 flex gap-3' },
                React.createElement('input', {
                    type: 'text',
                    value: newMessage,
                    onChange: (e) => setNewMessage(e.target.value),
                    placeholder: 'Digite sua mensagem...',
                    className: 'flex-1 p-3 bg-tecnoit-bg-light rounded-lg border border-transparent focus:ring-2 focus:ring-tecnoit-orange focus:border-transparent'
                }),
                React.createElement('button', { type: 'submit', className: 'bg-tecnoit-orange text-white font-bold py-3 px-6 rounded-lg hover:bg-tecnoit-orange-hover transition-colors' }, 'Enviar')
            )
        );
    }

    // --- Seção de Tarefas ---
    function Tasks() {
        const [tasks, setTasks] = React.useState([]);
        const [newTask, setNewTask] = React.useState('');

        React.useEffect(() => {
             if (!db || !userId) return;
             const tasksCol = collection(db, `artifacts/${app.options.appId}/users/${userId}/tasks`);
             const q = query(tasksCol);
             const unsubscribe = onSnapshot(q, (snapshot) => {
                 const userTasks = [];
                 snapshot.forEach(doc => userTasks.push({ id: doc.id, ...doc.data() }));
                 setTasks(userTasks);
             });
             return () => unsubscribe();
        }, []);

        const handleAddTask = async (e) => {
            e.preventDefault();
            if (newTask.trim() === '') return;
             const tasksCol = collection(db, `artifacts/${app.options.appId}/users/${userId}/tasks`);
            await addDoc(tasksCol, { text: newTask, completed: false, createdAt: serverTimestamp() });
            setNewTask('');
        };
        
        return React.createElement('div', null,
          React.createElement('h2', { className: 'text-2xl font-semibold mb-4' }, 'Minhas Tarefas'),
           React.createElement('form', { onSubmit: handleAddTask, className: 'flex gap-3 mb-4' },
                React.createElement('input', {
                    type: 'text',
                    value: newTask,
                    onChange: (e) => setNewTask(e.target.value),
                    placeholder: 'Adicionar nova tarefa...',
                    className: 'flex-1 p-3 bg-tecnoit-bg-light rounded-lg border border-transparent focus:ring-2 focus:ring-tecnoit-orange focus:border-transparent'
                }),
                React.createElement('button', { type: 'submit', className: 'bg-tecnoit-orange text-white font-bold py-3 px-6 rounded-lg hover:bg-tecnoit-orange-hover transition-colors' }, 'Adicionar')
            ),
             React.createElement('div', {className: 'space-y-2'}, 
                tasks.map(task => React.createElement('div', { key: task.id, className: 'bg-tecnoit-bg-light p-3 rounded-lg flex items-center' },
                    React.createElement('p', {className: 'flex-1'}, task.text)
                ))
            )
        );
    }
    
    // Renderiza a aplicação
    const root = ReactDOM.createRoot(document.getElementById("root"));
    try {
        root.render(React.createElement(App));
    } catch (e) {
        console.error("Erro CRÍTICO no render inicial:", e);
        const errorRoot = ReactDOM.createRoot(document.getElementById("root"));
        errorRoot.render(
            React.createElement('div', { style: { color: 'white', padding: '20px', fontFamily: 'monospace', backgroundColor: '#1a2035', height: '100vh' } },
                React.createElement('h1', { style: { fontSize: '24px' } }, 'Erro Crítico na Aplicação'),
                React.createElement('pre', { style: { whiteSpace: 'pre-wrap', wordBreak: 'break-all', marginTop: '10px' } }, e.toString()),
                React.createElement('pre', { style: { whiteSpace: 'pre-wrap', wordBreak: 'break-all', marginTop: '10px' } }, e.stack)
            )
        );
    }

  </script>
</body>

</html>

